<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Central de Comando - App de Estudos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        html, body { height: 100%; }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(-45deg, #111827, #1e1b4b, #312e81, #1e293b);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        .skeleton {
            animation: shimmer 2s infinite linear;
            background: linear-gradient(to right, #2d3748 4%, #3c4a5f 25%, #2d3748 36%);
            background-size: 1000px 100%;
        }
    </style>
</head>
<body class="text-slate-200">

    <div class="w-full max-w-5xl mx-auto h-full flex flex-col justify-center p-4 md:p-6">
        <div class="w-full bg-slate-900/70 backdrop-blur-xl border border-slate-700/50 rounded-3xl shadow-2xl shadow-black/30 p-6 md:p-8" style="animation: fadeIn 0.5s ease forwards;">
            
            <header class="text-center mb-8">
                <h1 class="text-4xl md:text-5xl font-extrabold text-white">Central de Comando</h1>
                <p class="text-slate-400 mt-2">Seu painel de controle para o sucesso nos estudos.</p>
            </header>

            <!-- KPIs -->
            <div id="kpi-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5 mb-8">
                <div class="bg-slate-800/80 p-5 rounded-xl border border-slate-700/50 skeleton h-24"></div>
                <div class="bg-slate-800/80 p-5 rounded-xl border border-slate-700/50 skeleton h-24"></div>
                <div class="bg-slate-800/80 p-5 rounded-xl border border-slate-700/50 skeleton h-24"></div>
                <div class="bg-slate-800/80 p-5 rounded-xl border border-slate-700/50 skeleton h-24"></div>
            </div>

            <!-- Navigation Links -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <a href="flashcards.html" class="group bg-slate-800/80 p-6 rounded-xl border border-slate-700/50 hover:border-indigo-500/80 hover:bg-slate-800 transition-all duration-300 transform hover:-translate-y-1">
                    <h2 class="text-xl font-bold text-white mb-2">Banco de Flashcards</h2>
                    <p class="text-slate-400 text-sm">Acesse seus decks, filtre por matéria e inicie suas sessões de revisão.</p>
                </a>
                <a href="pomodoro.html" class="group bg-slate-800/80 p-6 rounded-xl border border-slate-700/50 hover:border-indigo-500/80 hover:bg-slate-800 transition-all duration-300 transform hover:-translate-y-1">
                    <h2 class="text-xl font-bold text-white mb-2">Sessão de Foco</h2>
                    <p class="text-slate-400 text-sm">Inicie o timer Pomodoro para manter a concentração e registrar seu tempo de estudo.</p>
                </a>
                <a href="stats.html" class="group bg-slate-800/80 p-6 rounded-xl border border-slate-700/50 hover:border-indigo-500/80 hover:bg-slate-800 transition-all duration-300 transform hover:-translate-y-1">
                    <h2 class="text-xl font-bold text-white mb-2">Analisar Desempenho</h2>
                    <p class="text-slate-400 text-sm">Veja gráficos detalhados sobre seu progresso e tempo de estudo por matéria.</p>
                </a>
            </div>

            <!-- Recent Activity -->
            <div>
                <h3 class="text-lg font-semibold text-indigo-400 mb-3">Atividade Recente</h3>
                <div id="recent-activity-container" class="space-y-2">
                     <p class="text-sm text-slate-500">Nenhuma sessão de estudo registrada ainda.</p>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAJ7fpCQPimWgcJuYiLbCZ5Rf5YUgMVZ2Q",
            authDomain: "ghus-app.firebaseapp.com",
            projectId: "ghus-app",
            storageBucket: "ghus-app.firebasestorage.app",
            messagingSenderId: "1047907929485",
            appId: "1:1047907929485:web:cba05f2850df61d201c1c4",
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const DOM = {
            kpiContainer: document.getElementById('kpi-container'),
            recentActivityContainer: document.getElementById('recent-activity-container'),
        };

        function formatTime(minutes) {
            if (minutes < 60) return `${Math.round(minutes)} min`;
            const hours = Math.floor(minutes / 60);
            const remainingMinutes = Math.round(minutes % 60);
            return `${hours}h ${remainingMinutes}m`;
        }

        onAuthStateChanged(auth, user => {
            if (user) {
                // Flashcards KPIs
                onSnapshot(collection(db, 'flashcards'), snapshot => {
                    const totalCards = snapshot.size;
                    const reviewCards = snapshot.docs.filter(doc => doc.data().masteryColor === 'red').length;
                    
                    const kpi1 = DOM.kpiContainer.children[0];
                    const kpi2 = DOM.kpiContainer.children[1];
                    if(kpi1 && kpi2) {
                        kpi1.classList.remove('skeleton', 'h-24');
                        kpi2.classList.remove('skeleton', 'h-24');
                        kpi1.innerHTML = `<div><p class="text-sm text-slate-400">Total de Cards</p><p class="text-3xl font-bold text-white">${totalCards}</p></div>`;
                        kpi2.innerHTML = `<div><p class="text-sm text-slate-400">Revisão Urgente</p><p class="text-3xl font-bold text-red-400">${reviewCards}</p></div>`;
                    }
                });

                // Pomodoro KPIs & Recent Activity
                const sessionsQuery = query(collection(db, 'sessoesPomodoro'), orderBy('createdAt', 'desc'));
                onSnapshot(sessionsQuery, snapshot => {
                    const totalSessions = snapshot.size;
                    let totalTime = 0;
                    snapshot.docs.forEach(doc => { totalTime += doc.data().duracao || 0; });
                    
                    const kpi3 = DOM.kpiContainer.children[2];
                    const kpi4 = DOM.kpiContainer.children[3];
                     if(kpi3 && kpi4) {
                        kpi3.classList.remove('skeleton', 'h-24');
                        kpi4.classList.remove('skeleton', 'h-24');
                        kpi3.innerHTML = `<div><p class="text-sm text-slate-400">Sessões de Foco</p><p class="text-3xl font-bold text-white">${totalSessions}</p></div>`;
                        kpi4.innerHTML = `<div><p class="text-sm text-slate-400">Tempo Focado</p><p class="text-3xl font-bold text-white">${formatTime(totalTime)}</p></div>`;
                    }
                    
                    const recentSessions = snapshot.docs.slice(0, 3);
                    if (recentSessions.length > 0) {
                        DOM.recentActivityContainer.innerHTML = recentSessions.map(doc => {
                            const data = doc.data();
                            const date = data.createdAt ? data.createdAt.toDate().toLocaleDateString('pt-BR', { day: '2-digit', month: 'short' }) : '...';
                            return `<div class="bg-slate-800/50 p-3 rounded-lg text-sm flex justify-between items-center"><p class="text-slate-300">Sessão de <span class="font-semibold text-indigo-400">${data.tagEstudo}</span></p><p class="text-slate-400">${date} - ${data.duracao} min</p></div>`
                        }).join('');
                    }
                });

            } else {
                signInAnonymously(auth).catch(err => console.error(err));
            }
        });
    </script>
</body>
</html>

